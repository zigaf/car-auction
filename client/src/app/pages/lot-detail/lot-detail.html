<div class="lot-detail">
  <div class="container">
    @if (loading) {
      <div class="lot-detail__loading">Загрузка...</div>
    }

    @if (!loading && !lot) {
      <div class="lot-detail__not-found">
        <span class="material-symbols-rounded">error_outline</span>
        <h2>Лот не найден</h2>
        <a routerLink="/catalog">Вернуться в каталог</a>
      </div>
    }

    @if (lot) {
      <!-- Breadcrumb -->
      <nav class="breadcrumb">
        <a routerLink="/">Главная</a>
        <span class="material-symbols-rounded">chevron_right</span>
        <a routerLink="/catalog">Каталог</a>
        <span class="material-symbols-rounded">chevron_right</span>
        <span>{{ lot.title }}</span>
      </nav>

      <div class="lot-detail__grid">
        <!-- Left Column -->
        <div class="lot-detail__left">
          <!-- Gallery -->
          <div class="gallery">
            <div class="gallery__main">
              @if (currentImage) {
                <img [src]="currentImage" [alt]="lot.title" class="gallery__main-img">
              } @else {
                <div class="gallery__placeholder">
                  <span class="material-symbols-rounded">directions_car</span>
                  <span>Фото автомобиля</span>
                </div>
              }
              <button class="gallery__like">
                <span class="material-symbols-rounded">favorite</span>
              </button>
            </div>
            @if (images.length > 1) {
              <div class="gallery__thumbs">
                @for (img of images; track img.id; let i = $index) {
                  <div class="gallery__thumb" [class.gallery__thumb--active]="selectedImageIndex === i" (click)="selectImage(i)">
                    <img [src]="getImageUrl(img.url)" [alt]="'Фото ' + (i + 1)">
                  </div>
                }
              </div>
            }
          </div>

          <!-- Specs -->
          <div class="specs-section">
            <h2 class="section-title">Характеристики</h2>
            <div class="specs-grid">
              @if (lot.enginePowerPs || lot.enginePowerKw) {
                <div class="spec-item">
                  <span class="material-symbols-rounded spec-item__icon">speed</span>
                  <div class="spec-item__content">
                    <span class="spec-item__label">Мощность</span>
                    <span class="spec-item__value">
                      @if (lot.enginePowerPs) { {{ lot.enginePowerPs }} л.с. }
                      @if (lot.enginePowerKw) { ({{ lot.enginePowerKw }} кВт) }
                    </span>
                  </div>
                </div>
              }
              @if (lot.fuelType) {
                <div class="spec-item">
                  <span class="material-symbols-rounded spec-item__icon">local_gas_station</span>
                  <div class="spec-item__content">
                    <span class="spec-item__label">Топливо</span>
                    <span class="spec-item__value">{{ getFuelLabel(lot.fuelType) }}</span>
                  </div>
                </div>
              }
              @if (lot.mileage) {
                <div class="spec-item">
                  <span class="material-symbols-rounded spec-item__icon">speed</span>
                  <div class="spec-item__content">
                    <span class="spec-item__label">Пробег</span>
                    <span class="spec-item__value">{{ lot.mileage | number }} км</span>
                  </div>
                </div>
              }
              @if (lot.year) {
                <div class="spec-item">
                  <span class="material-symbols-rounded spec-item__icon">calendar_month</span>
                  <div class="spec-item__content">
                    <span class="spec-item__label">Год</span>
                    <span class="spec-item__value">{{ lot.year }}</span>
                  </div>
                </div>
              }
              @if (lot.exteriorColor) {
                <div class="spec-item">
                  <span class="material-symbols-rounded spec-item__icon">palette</span>
                  <div class="spec-item__content">
                    <span class="spec-item__label">Цвет</span>
                    <span class="spec-item__value">{{ lot.exteriorColor }}</span>
                  </div>
                </div>
              }
              @if (lot.vehicleType) {
                <div class="spec-item">
                  <span class="material-symbols-rounded spec-item__icon">directions_car</span>
                  <div class="spec-item__content">
                    <span class="spec-item__label">Тип</span>
                    <span class="spec-item__value">{{ lot.vehicleType }}</span>
                  </div>
                </div>
              }
            </div>

            @if (lot.vin) {
              <div class="vin-block">
                <span class="vin-block__label">VIN:</span>
                <code class="vin-block__value mono">{{ lot.vin }}</code>
              </div>
            }
          </div>

          <!-- Status badges -->
          <div class="status-section">
            <div class="status-badges">
              @if (lot.cosmeticGrade && lot.cosmeticGrade !== '-') {
                <span class="status-badge status-badge--docs">
                  <span class="material-symbols-rounded">star</span>
                  Cosmetic: {{ lot.cosmeticGrade }}
                </span>
              }
              @if (lot.mechanicalGrade && lot.mechanicalGrade !== '-' && lot.mechanicalGrade !== 'z') {
                <span class="status-badge status-badge--condition">
                  <span class="material-symbols-rounded">build</span>
                  Mechanical: {{ lot.mechanicalGrade }}
                </span>
              }
              @if (lot.saleCountry) {
                <span class="status-badge status-badge--docs">
                  <span class="material-symbols-rounded">public</span>
                  {{ lot.saleCountry }}
                </span>
              }
            </div>
          </div>
        </div>

        <!-- Right Column: Info Panel -->
        <div class="lot-detail__right">
          <div class="auction-panel">
            <div class="auction-panel__header">
              <h1 class="auction-panel__title">{{ lot.title }}</h1>
              @if (lot.derivative) {
                <span class="auction-panel__trim">{{ lot.derivative }}</span>
              }
            </div>

            <!-- Sale info -->
            <div class="auction-panel__price-row">
              <div class="auction-panel__price">
                @if (lot.startingBid) {
                  <span class="auction-panel__price-label">Стартовая цена</span>
                  <span class="auction-panel__price-value mono">{{ lot.startingBid | number }} {{ lot.originalCurrency || 'EUR' }}</span>
                } @else {
                  <span class="auction-panel__price-label">{{ lot.saleChannel || 'Аукцион' }}</span>
                  <span class="auction-panel__price-value mono">{{ lot.saleName }}</span>
                }
              </div>
            </div>

            @if (lot.buyNowPrice) {
              <div class="auction-panel__buynow">
                <span class="auction-panel__price-label">Buy Now</span>
                <span class="auction-panel__price-value mono">{{ lot.buyNowPrice | number }} {{ lot.originalCurrency || 'EUR' }}</span>
              </div>
            }

            <!-- Location -->
            <div class="auction-panel__info-rows">
              @if (lot.vehicleLocation) {
                <div class="auction-panel__info-row">
                  <span class="material-symbols-rounded">location_on</span>
                  <span>{{ lot.vehicleLocation }}</span>
                </div>
              }
              @if (lot.saleLocation) {
                <div class="auction-panel__info-row">
                  <span class="material-symbols-rounded">storefront</span>
                  <span>{{ lot.saleLocation }}</span>
                </div>
              }
              @if (lot.saleDate) {
                <div class="auction-panel__info-row">
                  <span class="material-symbols-rounded">event</span>
                  <span>{{ lot.saleDate }}</span>
                </div>
              }
              @if (lot.vatTypeCode) {
                <div class="auction-panel__info-row">
                  <span class="material-symbols-rounded">receipt</span>
                  <span>VAT: {{ lot.vatTypeCode }}</span>
                </div>
              }
              @if (lot.lotNumber) {
                <div class="auction-panel__info-row">
                  <span class="material-symbols-rounded">tag</span>
                  <span>Lot #{{ lot.lotNumber }}</span>
                </div>
              }
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>
