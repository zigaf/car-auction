<div class="my-bids">
  <h1 class="page-title">My Bids</h1>

  <!-- Tabs -->
  <div class="tabs">
    <button [class.active]="activeTab === 'all'" (click)="setTab('all')">
      All
      <span class="tabs__count">{{ counts.all }}</span>
    </button>
    <button [class.active]="activeTab === 'active'" (click)="setTab('active')">
      Active
      <span class="tabs__count">{{ counts.active }}</span>
    </button>
    <button [class.active]="activeTab === 'won'" (click)="setTab('won')">
      Won
      <span class="tabs__count">{{ counts.won }}</span>
    </button>
    <button [class.active]="activeTab === 'lost'" (click)="setTab('lost')">
      Lost
      <span class="tabs__count">{{ counts.lost }}</span>
    </button>
  </div>

  <!-- Loading -->
  @if (loading) {
    <div class="loading-state">
      <span class="material-symbols-rounded spin">progress_activity</span>
      <p>Loading your bids...</p>
    </div>
  }

  <!-- Error -->
  @if (error) {
    <div class="error-state">
      <span class="material-symbols-rounded">error</span>
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="loadBids()">Retry</button>
    </div>
  }

  <!-- Empty state -->
  @if (!loading && !error && filteredBids.length === 0) {
    <div class="empty-state">
      <span class="material-symbols-rounded">gavel</span>
      @if (activeTab === 'all') {
        <p>You have not placed any bids yet.</p>
      } @else if (activeTab === 'active') {
        <p>No active bids.</p>
      } @else if (activeTab === 'won') {
        <p>No won auctions yet.</p>
      } @else {
        <p>No lost auctions.</p>
      }
    </div>
  }

  <!-- Bids list -->
  @if (!loading && !error && filteredBids.length > 0) {
    <div class="bids-list">
      @for (bid of filteredBids; track bid.id) {
        <a class="bid-row" [routerLink]="['/catalog', bid.lotId]">
          <div class="bid-row__thumb">
            @if (getLotImage(bid)) {
              <img [src]="getLotImage(bid)" [alt]="bid.lot?.title || 'Lot'" class="bid-row__thumb-img">
            } @else {
              <span class="material-symbols-rounded">directions_car</span>
            }
          </div>
          <div class="bid-row__info">
            <span class="bid-row__name">{{ bid.lot?.title || 'Lot' }}</span>
            <span class="bid-row__date">{{ bid.createdAt | date:'dd MMM yyyy, HH:mm' }}</span>
          </div>
          <div class="bid-row__amounts">
            <span class="bid-row__my-bid">My bid: <strong>{{ bid.amount | number }} EUR</strong></span>
            @if (bid.lot?.currentPrice) {
              <span class="bid-row__current">Current: <strong>{{ bid.lot?.currentPrice | number }} EUR</strong></span>
            }
          </div>
          <div class="bid-status {{ getBidStatus(bid).cssClass }}">
            {{ getBidStatus(bid).label }}
          </div>
        </a>
      }
    </div>

    <!-- Pagination -->
    @if (totalPages > 1) {
      <div class="pagination">
        <button class="pagination__btn" [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">
          <span class="material-symbols-rounded">chevron_left</span>
        </button>
        <span class="pagination__info">Page {{ currentPage }} of {{ totalPages }}</span>
        <button class="pagination__btn" [disabled]="currentPage === totalPages" (click)="goToPage(currentPage + 1)">
          <span class="material-symbols-rounded">chevron_right</span>
        </button>
      </div>
    }
  }
</div>
