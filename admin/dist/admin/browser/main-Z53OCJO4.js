import{a as m}from"./chunk-4245ZNOS.js";import{a as L,b as B,d as W,e as d,h as Y}from"./chunk-RKYH57XR.js";import"./chunk-PQRFCLHD.js";import{q as z,r as $,s as q,t as G,u as V,v as Z,w as a}from"./chunk-Q2EY3VGC.js";import{A as v,Aa as E,Ca as j,D as S,Fa as D,Hb as x,Ia as N,K as y,Ma as M,N as C,Q as h,T as b,U as T,Ua as O,V as l,W as w,aa as P,ba as F,e as R,eb as U,ga as _,l as A,p,ra as H,z as I}from"./chunk-PMJPP6QG.js";var te="@",re=(()=>{class r{doc;delegate;zone;animationType;moduleImpl;_rendererFactoryPromise=null;scheduler=null;injector=l(P);loadingSchedulerFn=l(oe,{optional:!0});_engine;constructor(t,o,n,i,s){this.doc=t,this.delegate=o,this.zone=n,this.animationType=i,this.moduleImpl=s}ngOnDestroy(){this._engine?.flush()}loadImpl(){let t=()=>this.moduleImpl??import("./chunk-OY75FNZV.js").then(n=>n),o;return this.loadingSchedulerFn?o=this.loadingSchedulerFn(t):o=t(),o.catch(n=>{throw new C(5300,!1)}).then(({\u0275createEngine:n,\u0275AnimationRendererFactory:i})=>{this._engine=n(this.animationType,this.doc);let s=new i(this.delegate,this._engine,this.zone);return this.delegate=s,s})}createRenderer(t,o){let n=this.delegate.createRenderer(t,o);if(n.\u0275type===0)return n;typeof n.throwOnSyntheticProps=="boolean"&&(n.throwOnSyntheticProps=!1);let i=new k(n);return o?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(s=>{let c=s.createRenderer(t,o);i.use(c),this.scheduler??=this.injector.get(_,null,{optional:!0}),this.scheduler?.notify(10)}).catch(s=>{i.use(n)}),i}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}componentReplaced(t){this._engine?.flush(),this.delegate.componentReplaced?.(t)}static \u0275fac=function(o){N()};static \u0275prov=h({token:r,factory:r.\u0275fac})}return r})(),k=class{delegate;replay=[];\u0275type=1;constructor(e){this.delegate=e}use(e){if(this.delegate=e,this.replay!==null){for(let t of this.replay)t(e);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}get destroyNode(){return this.delegate.destroyNode}appendChild(e,t){this.delegate.appendChild(e,t)}insertBefore(e,t,o,n){this.delegate.insertBefore(e,t,o,n)}removeChild(e,t,o,n){this.delegate.removeChild(e,t,o,n)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,o,n){this.delegate.setAttribute(e,t,o,n)}removeAttribute(e,t,o){this.delegate.removeAttribute(e,t,o)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,o,n){this.delegate.setStyle(e,t,o,n)}removeStyle(e,t,o){this.delegate.removeStyle(e,t,o)}setProperty(e,t,o){this.shouldReplay(t)&&this.replay.push(n=>n.setProperty(e,t,o)),this.delegate.setProperty(e,t,o)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,o,n){return this.shouldReplay(t)&&this.replay.push(i=>i.listen(e,t,o,n)),this.delegate.listen(e,t,o,n)}shouldReplay(e){return this.replay!==null&&e.startsWith(te)}},oe=new b("");function X(r="animations"){return E("NgAsyncAnimations"),w([{provide:D,useFactory:(e,t,o)=>new re(e,t,o,r),deps:[F,L,j]},{provide:H,useValue:r==="noop"?"NoopAnimations":"BrowserAnimations"}])}var K=()=>{let r=l(m),e=l(d);return r.isLoggedIn&&r.isManager||localStorage.getItem("accessToken")?!0:e.createUrlTree(["/login"])};var Q=[{path:"login",loadComponent:()=>import("./chunk-A6AUWSPD.js").then(r=>r.LoginPage)},{path:"",loadComponent:()=>import("./chunk-3LFAJEEO.js").then(r=>r.AdminLayout),canActivate:[K],children:[{path:"",redirectTo:"lots",pathMatch:"full"},{path:"lots",loadComponent:()=>import("./chunk-SDQVFQED.js").then(r=>r.LotsPage)},{path:"lots/:id",loadComponent:()=>import("./chunk-S2R2KW3C.js").then(r=>r.LotDetailComponent)},{path:"orders",loadComponent:()=>import("./chunk-XVT7UR3V.js").then(r=>r.OrdersPage)},{path:"users",loadComponent:()=>import("./chunk-BM37FQEU.js").then(r=>r.UsersPage)},{path:"documents",loadComponent:()=>import("./chunk-YQ4QLPUA.js").then(r=>r.DocumentsPage)},{path:"users/:id",loadComponent:()=>import("./chunk-36BZFROW.js").then(r=>r.UserDetailComponent)},{path:"tasks",loadComponent:()=>import("./chunk-MPCW5VPI.js").then(r=>r.TasksPage)},{path:"auctions/schedule",loadComponent:()=>import("./chunk-HCZW2CDJ.js").then(r=>r.SchedulePage)},{path:"bots",loadComponent:()=>import("./chunk-FEVVI247.js").then(r=>r.BotsPage)},{path:"monitor",loadComponent:()=>import("./chunk-XXXS2CBG.js").then(r=>r.MonitorComponent)},{path:"scraper",loadComponent:()=>import("./chunk-HZ4IUP6O.js").then(r=>r.ScraperPageComponent)}]},{path:"**",redirectTo:""}];var u=class r{constructor(e,t){this.router=e;this.http=t}isRefreshing=!1;refreshTokenSubject=new A(null);intercept(e,t){let o=this.getAccessToken(),n=e;return o&&this.isApiRequest(e.url)&&(n=this.addToken(e,o)),t.handle(n).pipe(v(i=>i.status===401&&this.isApiRequest(e.url)&&!e.url.includes("/auth/refresh")&&!e.url.includes("/auth/login")?this.handle401Error(n,t):p(()=>i)))}addToken(e,t){return e.clone({setHeaders:{Authorization:`Bearer ${t}`}})}isApiRequest(e){return e.startsWith(a.apiUrl)}handle401Error(e,t){if(!this.isRefreshing){this.isRefreshing=!0,this.refreshTokenSubject.next(null);let o=this.getRefreshToken();return o?this.http.post(`${a.apiUrl}/auth/refresh`,{refreshToken:o}).pipe(y(n=>(this.isRefreshing=!1,localStorage.setItem("accessToken",n.accessToken),localStorage.setItem("refreshToken",n.refreshToken),this.refreshTokenSubject.next(n.accessToken),t.handle(this.addToken(e,n.accessToken)))),v(n=>(this.isRefreshing=!1,this.clearTokensAndRedirect(),p(()=>n)))):(this.isRefreshing=!1,this.clearTokensAndRedirect(),p(()=>new z({status:401})))}return this.refreshTokenSubject.pipe(I(o=>o!==null),S(1),y(o=>t.handle(this.addToken(e,o))))}getAccessToken(){return localStorage.getItem("accessToken")}getRefreshToken(){return localStorage.getItem("refreshToken")}clearTokensAndRedirect(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),this.router.navigate(["/login"])}static \u0275fac=function(t){return new(t||r)(T(d),T($))};static \u0275prov=h({token:r,factory:r.\u0275fac})};function ne(r){return()=>R(null,null,function*(){let e=localStorage.getItem("accessToken");if(e)try{let t=yield fetch(`${a.apiUrl}/users/me`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok){let n=localStorage.getItem("refreshToken");if(!n){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken");return}let i=yield fetch(`${a.apiUrl}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:n})});if(!i.ok){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken");return}let s=yield i.json();localStorage.setItem("accessToken",s.accessToken),localStorage.setItem("refreshToken",s.refreshToken);let c=yield fetch(`${a.apiUrl}/users/me`,{headers:{Authorization:`Bearer ${s.accessToken}`}});if(!c.ok){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken");return}let g=yield c.json();g.role==="manager"||g.role==="admin"?r.setUser(g):(localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"));return}let o=yield t.json();o.role==="manager"||o.role==="admin"?r.setUser(o):(localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"))}catch{}})}var ee={providers:[x({eventCoalescing:!0}),Y(Q),G(Z(),V()),{provide:q,useClass:u,multi:!0},X(),{provide:O,useFactory:ne,deps:[m],multi:!0}]};var f=class r{static \u0275fac=function(t){return new(t||r)};static \u0275cmp=M({type:r,selectors:[["app-root"]],decls:1,vars:0,template:function(t,o){t&1&&U(0,"router-outlet")},dependencies:[W],encapsulation:2})};B(f,ee).catch(r=>console.error(r));
