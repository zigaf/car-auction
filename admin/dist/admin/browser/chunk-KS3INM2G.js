import{a as j}from"./chunk-ZLGP2HS2.js";import{c as L,f as H,i as Q,j as U,k as W,p as $}from"./chunk-NMP7FLI7.js";import{f as R,g as I,h as T,i as A,l as N,r as z,w as g}from"./chunk-Q2EY3VGC.js";import{$ as d,Ab as D,Cb as B,Eb as F,Ma as x,Nb as V,Ra as C,V as _,_ as c,bb as u,cb as e,db as t,eb as h,fb as v,ib as m,lb as y,mb as P,nb as M,ob as O,qb as n,rb as S,sb as p,wa as a,wb as w,xb as k,yb as E}from"./chunk-PMJPP6QG.js";var G=["terminalBody"],J=l=>({"terminal-text--error":l});function K(l,o){l&1&&(e(0,"div",34),n(1," \u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0445 \u043B\u043E\u0433\u043E\u0432. \u041F\u0430\u0440\u0441\u0435\u0440 \u0435\u0449\u0435 \u043D\u0435 \u0431\u044B\u043B \u0437\u0430\u043F\u0443\u0449\u0435\u043D. "),t())}function X(l,o){if(l&1&&(e(0,"div",35)(1,"span",36),n(2),B(3,"date"),t(),e(4,"span",37),n(5),t()()),l&2){let i=o.$implicit;a(2),p("[",F(3,3,i.timestamp,"HH:mm:ss"),"]"),a(2),u("ngClass",D(6,J,i.message.includes("Error")||i.message.includes("Fail"))),a(),S(i.message)}}var q=class l{http=_(z);cdr=_(V);socket;terminalBody;isRunning=!1;logs=[];selectedVendor="ecarstrade";shouldScroll=!1;ngOnInit(){this.checkStatus();let o=g.apiUrl.replace("/api","")+"/scraper";this.socket=j(o,{transports:["websocket"]}),this.socket.on("scraper-log",i=>{this.logs.push(i),this.shouldScroll=!0,this.cdr.detectChanges()})}ngAfterViewChecked(){this.shouldScroll&&(this.scrollToBottom(),this.shouldScroll=!1)}ngOnDestroy(){this.socket&&this.socket.disconnect()}checkStatus(){this.http.get(`${g.apiUrl}/scraper/status`).subscribe(o=>{this.isRunning=o.isRunning,this.cdr.detectChanges()})}startScraper(){this.isRunning||(this.isRunning=!0,this.logs=[{timestamp:new Date().toISOString(),message:`Starting ${this.selectedVendor} scraper task...`}],this.http.post(`${g.apiUrl}/scraper/run`,{vendor:this.selectedVendor,maxPages:1}).subscribe({next:o=>{this.logs.push({timestamp:new Date().toISOString(),message:"Scraper process initialized successfully."}),this.checkStatus()},error:o=>{this.isRunning=!1,this.logs.push({timestamp:new Date().toISOString(),message:`Error starting scraper: ${o.message}`}),this.cdr.detectChanges()}}))}clearLogs(){this.logs=[]}scrollToBottom(){this.terminalBody&&(this.terminalBody.nativeElement.scrollTop=this.terminalBody.nativeElement.scrollHeight)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=x({type:l,selectors:[["app-scraper-page"]],viewQuery:function(i,r){if(i&1&&y(G,5),i&2){let s;P(s=M())&&(r.terminalBody=s.first)}},decls:49,vars:9,consts:[["terminalBody",""],[1,"page-header"],[1,"page-header__title-area"],[1,"page-header__title"],[1,"page-header__subtitle"],[1,"page-header__actions"],[1,"btn","btn--outline",3,"click"],[1,"material-symbols-rounded"],[1,"scraper-content"],[1,"card","scraper-control-card"],[1,"card-body"],[1,"card-title"],[1,"control-form"],[1,"form-group"],[1,"form-label"],[1,"form-select",3,"ngModelChange","ngModel","disabled"],["value","ecarstrade"],["value","autobid"],[1,"form-actions"],[1,"btn","btn--primary",3,"click","disabled"],[1,"status-indicator"],[1,"status-indicator__dot"],[1,"status-indicator__text"],[1,"card","terminal-card"],[1,"terminal-header"],[1,"terminal-header__actions"],[1,"terminal-btn","terminal-btn--red"],[1,"terminal-btn","terminal-btn--yellow"],[1,"terminal-btn","terminal-btn--green"],[1,"terminal-title"],["title","\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u043B\u043E\u0433\u0438",1,"btn","btn--icon","terminal-clear",3,"click"],[1,"terminal-body"],["class","terminal-empty",4,"ngIf"],["class","terminal-line",4,"ngFor","ngForOf"],[1,"terminal-empty"],[1,"terminal-line"],[1,"terminal-time"],[1,"terminal-text",3,"ngClass"]],template:function(i,r){if(i&1){let s=v();e(0,"div",1)(1,"div",2)(2,"h1",3),n(3,"\u041F\u0430\u0440\u0441\u0435\u0440"),t(),e(4,"p",4),n(5,"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0441\u0431\u043E\u0440\u043E\u043C \u0434\u0430\u043D\u043D\u044B\u0445 \u0441 \u0430\u0443\u043A\u0446\u0438\u043E\u043D\u043E\u0432"),t()(),e(6,"div",5)(7,"button",6),m("click",function(){return c(s),d(r.checkStatus())}),e(8,"span",7),n(9,"refresh"),t(),n(10," \u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 "),t()()(),e(11,"div",8)(12,"div",9)(13,"div",10)(14,"h2",11),n(15,"\u0417\u0430\u043F\u0443\u0441\u043A \u043F\u0430\u0440\u0441\u0435\u0440\u0430"),t(),e(16,"div",12)(17,"div",13)(18,"label",14),n(19,"\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A \u0434\u0430\u043D\u043D\u044B\u0445"),t(),e(20,"select",15),E("ngModelChange",function(b){return c(s),k(r.selectedVendor,b)||(r.selectedVendor=b),d(b)}),e(21,"option",16),n(22,"eCarsTrade"),t(),e(23,"option",17),n(24,"Autobid.de"),t()()(),e(25,"div",18)(26,"button",19),m("click",function(){return c(s),d(r.startScraper())}),e(27,"span",7),n(28,"play_arrow"),t(),n(29),t()()(),e(30,"div",20),h(31,"span",21),e(32,"span",22),n(33),t()()()(),e(34,"div",23)(35,"div",24)(36,"div",25),h(37,"div",26)(38,"div",27)(39,"div",28),t(),e(40,"div",29),n(41,"Live Logs"),t(),e(42,"button",30),m("click",function(){return c(s),d(r.clearLogs())}),e(43,"span",7),n(44,"clear_all"),t()()(),e(45,"div",31,0),C(47,K,2,0,"div",32)(48,X,6,8,"div",33),t()()()}i&2&&(a(20),w("ngModel",r.selectedVendor),u("disabled",r.isRunning),a(6),u("disabled",r.isRunning),a(3),p(" ",r.isRunning?"\u041F\u0430\u0440\u0441\u0435\u0440 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442...":"\u0417\u0430\u043F\u0443\u0441\u0442\u0438\u0442\u044C \u043F\u0430\u0440\u0441\u0435\u0440"," "),a(),O("status-indicator--running",r.isRunning),a(3),p(" ",r.isRunning?"\u0410\u043A\u0442\u0438\u0432\u043D\u044B\u0439 \u043F\u0440\u043E\u0446\u0435\u0441\u0441 \u0441\u0431\u043E\u0440\u0430 \u0434\u0430\u043D\u043D\u044B\u0445":"\u041E\u0436\u0438\u0434\u0430\u0435\u0442 \u0437\u0430\u043F\u0443\u0441\u043A\u0430"," "),a(14),u("ngIf",r.logs.length===0),a(),u("ngForOf",r.logs))},dependencies:[N,R,I,T,$,U,W,Q,L,H,A],styles:[".scraper-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px;max-width:1000px}.scraper-control-card[_ngcontent-%COMP%]{padding:24px;background-color:var(--surface);border-radius:12px;border:1px solid var(--border)}.scraper-control-card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{margin-top:0;margin-bottom:20px;font-size:1.25rem;font-weight:600}.control-form[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:16px;margin-bottom:24px}.control-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1;max-width:300px}.control-form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-size:.875rem;font-weight:500;color:var(--text-secondary)}.control-form[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]{width:100%;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background-color:var(--surface);color:var(--text);font-size:.95rem;outline:none;transition:all .2s ease}.control-form[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]:focus{border-color:var(--primary)}.status-indicator[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;padding:8px 16px;border-radius:20px;background-color:var(--surface-hover);border:1px solid var(--border)}.status-indicator__dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;background-color:var(--text-secondary);transition:background-color .3s ease}.status-indicator__text[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--text-secondary)}.status-indicator--running[_ngcontent-%COMP%]{background-color:#22c55e1a;border-color:#22c55e33}.status-indicator--running[_ngcontent-%COMP%]   .status-indicator__dot[_ngcontent-%COMP%]{background-color:#22c55e;box-shadow:0 0 8px #22c55e99;animation:_ngcontent-%COMP%_pulse 1.5s infinite}.status-indicator--running[_ngcontent-%COMP%]   .status-indicator__text[_ngcontent-%COMP%]{color:#16a34a}@keyframes _ngcontent-%COMP%_pulse{0%{box-shadow:0 0 #22c55eb3}70%{box-shadow:0 0 0 10px #22c55e00}to{box-shadow:0 0 #22c55e00}}.terminal-card[_ngcontent-%COMP%]{border-radius:12px;overflow:hidden;background-color:#1a1a1a;border:1px solid #333;box-shadow:0 4px 20px #00000026}.terminal-header[_ngcontent-%COMP%]{display:flex;align-items:center;background-color:#2a2a2a;padding:12px 16px;border-bottom:1px solid #111}.terminal-header__actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-right:16px}.terminal-btn[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%}.terminal-btn--red[_ngcontent-%COMP%]{background-color:#ff5f56}.terminal-btn--yellow[_ngcontent-%COMP%]{background-color:#ffbd2e}.terminal-btn--green[_ngcontent-%COMP%]{background-color:#27c93f}.terminal-title[_ngcontent-%COMP%]{color:#888;font-family:monospace;font-size:.875rem;flex:1;text-align:center}.terminal-clear[_ngcontent-%COMP%]{color:#888;padding:4px;background:none;border:none;border-radius:4px;cursor:pointer}.terminal-clear[_ngcontent-%COMP%]:hover{color:#fff;background-color:#ffffff1a}.terminal-clear[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px}.terminal-body[_ngcontent-%COMP%]{height:400px;overflow-y:auto;padding:16px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:.85rem;line-height:1.5;color:#e2e8f0}.terminal-body[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.terminal-body[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1a1a1a}.terminal-body[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#444;border-radius:4px}.terminal-empty[_ngcontent-%COMP%]{color:#666;font-style:italic;text-align:center;margin-top:40px}.terminal-line[_ngcontent-%COMP%]{margin-bottom:4px;word-wrap:break-word}.terminal-time[_ngcontent-%COMP%]{color:#8b949e;margin-right:12px;-webkit-user-select:none;user-select:none}.terminal-text[_ngcontent-%COMP%]{color:#a3be8c}.terminal-text--error[_ngcontent-%COMP%]{color:#bf616a}"]})};export{q as ScraperPageComponent};
