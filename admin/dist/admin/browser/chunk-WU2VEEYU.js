import{a as te}from"./chunk-GXIRCPNU.js";import{a as X}from"./chunk-WNJNJDEA.js";import{a as ee}from"./chunk-LWVZYZWF.js";import{c as G}from"./chunk-ELGPTX6G.js";import{a as Y,b as I,c as O,f as B,h as q,i as J,j as K,k as Q,m as Z,o as $,p as F}from"./chunk-3D23ORGU.js";import{g as U,h as z,t as H}from"./chunk-XJI6OOWZ.js";import{$ as p,$a as v,Bb as T,La as M,Q as N,U as R,V as S,Wa as c,Xa as m,Ya as L,Za as w,_,_a as D,ab as i,bb as t,cb as j,db as h,gb as C,hb as u,lb as k,mb as P,nb as a,ob as b,pb as E,qb as W,tb as g,ub as x,vb as f,wa as l,zb as y}from"./chunk-AYG5IDLV.js";var V=class n{constructor(o){this.api=o}getUserBalance(o){return this.api.get(`/balance/user/${o}`)}getUserTransactions(o,e=1,s=20){return this.api.get(`/balance/user/${o}/transactions`,{page:e,limit:s})}adjustBalance(o,e){return this.api.post(`/balance/${o}/adjust`,e)}static \u0275fac=function(e){return new(e||n)(R(H))};static \u0275prov=N({token:n,factory:n.\u0275fac,providedIn:"root"})};var re=(n,o)=>o.id;function le(n,o){n&1&&(i(0,"span",16),a(1,"progress_activity"),t())}function se(n,o){if(n&1){let e=h();i(0,"div",5)(1,"div",9)(2,"label",10),a(3,"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A *"),t(),i(4,"input",11),f("ngModelChange",function(r){_(e);let d=u();return x(d.newTitle,r)||(d.newTitle=r),p(r)}),t()(),i(5,"div",9)(6,"label",10),a(7,"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435"),t(),i(8,"textarea",12),f("ngModelChange",function(r){_(e);let d=u();return x(d.newDescription,r)||(d.newDescription=r),p(r)}),t()(),i(9,"div",9)(10,"label",10),a(11,"\u0421\u0440\u043E\u043A \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F"),t(),i(12,"input",13),f("ngModelChange",function(r){_(e);let d=u();return x(d.newDueDate,r)||(d.newDueDate=r),p(r)}),t()(),i(13,"div",14)(14,"button",15),C("click",function(){_(e);let r=u();return p(r.createTask())}),c(15,le,2,0,"span",16),a(16," \u0421\u043E\u0437\u0434\u0430\u0442\u044C "),t()()()}if(n&2){let e=u();l(4),g("ngModel",e.newTitle),l(4),g("ngModel",e.newDescription),l(4),g("ngModel",e.newDueDate),l(2),v("disabled",!e.newTitle||e.creating),l(),m(e.creating?15:-1)}}function ue(n,o){n&1&&(i(0,"div",6)(1,"span",16),a(2,"progress_activity"),t()())}function de(n,o){n&1&&(i(0,"div",7)(1,"span",4),a(2,"checklist"),t(),i(3,"p"),a(4,"\u041D\u0435\u0442 \u0437\u0430\u0434\u0430\u0447"),t()())}function ce(n,o){if(n&1&&(i(0,"div",20),a(1),t()),n&2){let e=u().$implicit;l(),b(e.description)}}function me(n,o){if(n&1&&(i(0,"div",21)(1,"span",25),a(2,"calendar_today"),t(),a(3),y(4,"date"),t()),n&2){let e=u().$implicit;l(3),E(" ",T(4,1,e.dueDate,"dd.MM.yy")," ")}}function _e(n,o){if(n&1){let e=h();i(0,"div",17)(1,"div",18)(2,"div",19),a(3),t(),c(4,ce,2,1,"div",20),c(5,me,5,4,"div",21),t(),i(6,"div",22)(7,"button",23),C("click",function(){let r=_(e).$implicit,d=u(2);return p(d.cycleStatus(r))}),a(8),t(),i(9,"button",24),C("click",function(){let r=_(e).$implicit,d=u(2);return p(d.deleteTask(r.id))}),i(10,"span",4),a(11,"delete"),t()()()()}if(n&2){let e=o.$implicit,s=u(2);l(3),b(e.title),l(),m(e.description?4:-1),l(),m(e.dueDate?5:-1),l(2),P(s.statusClass(e.status)),l(),E(" ",s.statusLabels[e.status]," ")}}function pe(n,o){if(n&1&&(i(0,"div",8),w(1,_e,12,6,"div",17,re),t()),n&2){let e=u();l(),D(e.tasks)}}var Ce={TODO:"\u0421\u0434\u0435\u043B\u0430\u0442\u044C",IN_PROGRESS:"\u0412 \u0440\u0430\u0431\u043E\u0442\u0435",DONE:"\u0413\u043E\u0442\u043E\u0432\u043E"},ge={TODO:"IN_PROGRESS",IN_PROGRESS:"DONE",DONE:"TODO"},A=class n{userId="";taskService=S(te);authService=S(X);tasks=[];loading=!0;showForm=!1;newTitle="";newDescription="";newDueDate="";creating=!1;statusLabels=Ce;ngOnInit(){this.load()}load(){this.loading=!0,this.taskService.getTasksByUser(this.userId).subscribe({next:o=>{this.tasks=o,this.loading=!1},error:()=>this.loading=!1})}createTask(){if(!this.newTitle.trim())return;let o=this.authService.currentUser?.id??"";this.creating=!0,this.taskService.createTask({targetUserId:this.userId,assignedToId:o,title:this.newTitle.trim(),description:this.newDescription||void 0,dueDate:this.newDueDate||void 0}).subscribe({next:e=>{this.tasks=[e,...this.tasks],this.newTitle="",this.newDescription="",this.newDueDate="",this.showForm=!1,this.creating=!1},error:()=>this.creating=!1})}cycleStatus(o){let e=ge[o.status];this.taskService.updateTask(o.id,{status:e}).subscribe({next:s=>{let r=this.tasks.findIndex(d=>d.id===o.id);r!==-1&&(this.tasks[r]=s)}})}deleteTask(o){this.taskService.deleteTask(o).subscribe({next:()=>{this.tasks=this.tasks.filter(e=>e.id!==o)}})}statusClass(o){return{TODO:"badge--gray",IN_PROGRESS:"badge--amber",DONE:"badge--green"}[o]??""}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=M({type:n,selectors:[["app-user-tasks"]],inputs:{userId:"userId"},decls:12,vars:6,consts:[[1,"user-tasks"],[1,"user-tasks__header"],[1,"user-tasks__title"],[1,"btn","btn--primary","btn--sm",3,"click"],[1,"material-symbols-rounded"],[1,"task-form","card"],[1,"state-loading"],[1,"empty-state"],[1,"task-list"],[1,"form-group"],[1,"form-label"],["placeholder","\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0437\u0430\u0434\u0430\u0447\u0438",1,"form-control",3,"ngModelChange","ngModel"],["rows","3","placeholder","\u041F\u043E\u0434\u0440\u043E\u0431\u043D\u043E\u0441\u0442\u0438...",1,"form-control",3,"ngModelChange","ngModel"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-actions"],[1,"btn","btn--primary","btn--sm",3,"click","disabled"],[1,"material-symbols-rounded","spin"],[1,"task-item","card"],[1,"task-item__main"],[1,"task-item__title"],[1,"task-item__desc","text-muted"],[1,"task-item__due","text-muted"],[1,"task-item__actions"],["title","\u041D\u0430\u0436\u043C\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0438\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441",1,"badge","badge--clickable",3,"click"],["title","\u0423\u0434\u0430\u043B\u0438\u0442\u044C",1,"icon-btn","icon-btn--danger",3,"click"],[1,"material-symbols-rounded",2,"font-size","14px"]],template:function(e,s){e&1&&(i(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"\u0417\u0430\u0434\u0430\u0447\u0438"),t(),i(4,"button",3),C("click",function(){return s.showForm=!s.showForm}),i(5,"span",4),a(6),t(),a(7),t()(),c(8,se,17,5,"div",5),c(9,ue,3,0,"div",6),c(10,de,5,0,"div",7),c(11,pe,3,0,"div",8),t()),e&2&&(l(6),b(s.showForm?"close":"add"),l(),E(" ",s.showForm?"\u041E\u0442\u043C\u0435\u043D\u0430":"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0437\u0430\u0434\u0430\u0447\u0443"," "),l(),m(s.showForm?8:-1),l(),m(s.loading?9:-1),l(),m(!s.loading&&s.tasks.length===0?10:-1),l(),m(!s.loading&&s.tasks.length>0?11:-1))},dependencies:[F,I,O,B,U],styles:[".user-tasks[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.user-tasks__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.user-tasks__title[_ngcontent-%COMP%]{font-size:var(--fs-base);font-weight:600;margin:0}.task-form[_ngcontent-%COMP%]{padding:16px;display:flex;flex-direction:column;gap:12px}.task-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.task-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;padding:14px 16px}.task-item__main[_ngcontent-%COMP%]{flex:1;min-width:0;display:flex;flex-direction:column;gap:4px}.task-item__title[_ngcontent-%COMP%]{font-weight:500;font-size:var(--fs-sm)}.task-item__desc[_ngcontent-%COMP%]{font-size:var(--fs-xs)}.task-item__due[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:var(--fs-xs)}.task-item__actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-shrink:0}.badge--clickable[_ngcontent-%COMP%]{cursor:pointer;border:none}.badge--clickable[_ngcontent-%COMP%]:hover{opacity:.8}.icon-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:28px;height:28px;border:none;background:none;cursor:pointer;border-radius:var(--radius);color:var(--text-secondary);transition:background .15s,color .15s}.icon-btn[_ngcontent-%COMP%]:hover{background:var(--surface-hover)}.icon-btn--danger[_ngcontent-%COMP%]:hover{background:rgba(var(--red-rgb, 220, 38, 38),.1);color:var(--red)}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.form-label[_ngcontent-%COMP%]{font-size:var(--fs-sm);color:var(--text-secondary);font-weight:500}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"]})};var xe=(n,o)=>o.id;function fe(n,o){if(n&1&&(i(0,"span",3),a(1),t()),n&2){let e=u();l(),b(e.user.email)}}function be(n,o){n&1&&(i(0,"div",4)(1,"span",6),a(2,"progress_activity"),t()())}function ve(n,o){if(n&1&&(i(0,"div",5)(1,"span",7),a(2,"error"),t(),a(3),t()),n&2){let e=u();l(3),E(" ",e.error," ")}}function he(n,o){n&1&&(i(0,"div",8)(1,"span",7),a(2,"warning"),t(),i(3,"div",13)(4,"strong"),a(5,"\u041E\u0433\u0440\u0430\u043D\u0438\u0447\u0435\u043D\u043D\u044B\u0439 \u0440\u0435\u0433\u0438\u043E\u043D"),t(),a(6," \u041F\u043E \u0442\u0440\u0435\u0431\u043E\u0432\u0430\u043D\u0438\u044E \u043D\u0430\u0448\u0435\u0433\u043E \u043F\u0430\u0440\u0442\u043D\u0451\u0440\u0430 "),i(7,"strong"),a(8,"autobid.de"),t(),a(9,", \u0434\u043B\u044F \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439 \u0438\u0437 \u0420\u043E\u0441\u0441\u0438\u0438 \u0438 \u0420\u0435\u0441\u043F\u0443\u0431\u043B\u0438\u043A\u0438 \u0411\u0435\u043B\u0430\u0440\u0443\u0441\u044C \u0444\u0443\u043D\u043A\u0446\u0438\u043E\u043D\u0430\u043B \u043F\u043B\u0430\u0442\u0444\u043E\u0440\u043C\u044B \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043E\u0433\u0440\u0430\u043D\u0438\u0447\u0435\u043D. "),t()())}function Ee(n,o){if(n&1&&(i(0,"option",22),a(1),t()),n&2){let e=o.$implicit;v("value",e),l(),b(e)}}function Se(n,o){if(n&1&&(i(0,"option",22),a(1),t()),n&2){let e=o.$implicit;v("value",e),l(),b(e)}}function ye(n,o){n&1&&(i(0,"span",6),a(1,"progress_activity"),t())}function Te(n,o){n&1&&(i(0,"span",28)(1,"span",7),a(2,"check_circle"),t(),a(3," \u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u043E "),t())}function we(n,o){if(n&1&&(i(0,"span",29),a(1),t()),n&2){let e=u(3);l(),b(e.error)}}function De(n,o){if(n&1){let e=h();i(0,"div",11)(1,"div",14)(2,"div",15)(3,"label",16),a(4,"\u0418\u043C\u044F"),t(),i(5,"input",17),f("ngModelChange",function(r){_(e);let d=u(2);return x(d.formFirstName,r)||(d.formFirstName=r),p(r)}),t()(),i(6,"div",15)(7,"label",16),a(8,"\u0424\u0430\u043C\u0438\u043B\u0438\u044F"),t(),i(9,"input",18),f("ngModelChange",function(r){_(e);let d=u(2);return x(d.formLastName,r)||(d.formLastName=r),p(r)}),t()(),i(10,"div",15)(11,"label",16),a(12,"\u0422\u0435\u043B\u0435\u0444\u043E\u043D"),t(),i(13,"input",19),f("ngModelChange",function(r){_(e);let d=u(2);return x(d.formPhone,r)||(d.formPhone=r),p(r)}),t()(),i(14,"div",15)(15,"label",16),a(16,"\u0424\u043B\u0430\u0433 \u0441\u0442\u0440\u0430\u043D\u044B (emoji)"),t(),i(17,"input",20),f("ngModelChange",function(r){_(e);let d=u(2);return x(d.formCountryFlag,r)||(d.formCountryFlag=r),p(r)}),t()(),i(18,"div",15)(19,"label",16),a(20,"\u0421\u0442\u0430\u0442\u0443\u0441"),t(),i(21,"select",21),f("ngModelChange",function(r){_(e);let d=u(2);return x(d.formStatus,r)||(d.formStatus=r),p(r)}),w(22,Ee,2,2,"option",22,L),t()(),i(24,"div",15)(25,"label",16),a(26,"\u0420\u043E\u043B\u044C"),t(),i(27,"select",21),f("ngModelChange",function(r){_(e);let d=u(2);return x(d.formRole,r)||(d.formRole=r),p(r)}),w(28,Se,2,2,"option",22,L),t()(),i(30,"div",23)(31,"label",24)(32,"input",25),f("ngModelChange",function(r){_(e);let d=u(2);return x(d.formIsVerified,r)||(d.formIsVerified=r),p(r)}),t(),a(33," \u0412\u0435\u0440\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u044F \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0430 "),t()()(),i(34,"div",26)(35,"button",27),C("click",function(){_(e);let r=u(2);return p(r.saveInfo())}),c(36,ye,2,0,"span",6),a(37," \u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C "),t(),c(38,Te,4,0,"span",28),c(39,we,2,1,"span",29),t()()}if(n&2){let e=u(2);l(5),g("ngModel",e.formFirstName),l(4),g("ngModel",e.formLastName),l(4),g("ngModel",e.formPhone),l(4),g("ngModel",e.formCountryFlag),l(4),g("ngModel",e.formStatus),l(),D(e.statuses),l(5),g("ngModel",e.formRole),l(),D(e.roles),l(4),g("ngModel",e.formIsVerified),l(3),v("disabled",e.saving),l(),m(e.saving?36:-1),l(2),m(e.saveSuccess?38:-1),l(),m(e.error&&!e.loading?39:-1)}}function ke(n,o){n&1&&(i(0,"div",4)(1,"span",6),a(2,"progress_activity"),t()())}function Me(n,o){n&1&&(i(0,"div",35)(1,"span",7),a(2,"lock"),t(),i(3,"div")(4,"strong"),a(5,"\u041F\u043E\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u0435 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u043E"),t(),i(6,"p"),a(7,"\u0414\u0435\u043F\u043E\u0437\u0438\u0442 \u0432\u043E\u0437\u043C\u043E\u0436\u0435\u043D \u0442\u043E\u043B\u044C\u043A\u043E \u043F\u043E\u0441\u043B\u0435 \u0432\u0435\u0440\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F. \u0412\u043A\u043B\u044E\u0447\u0438\u0442\u0435 \xAB\u0412\u0435\u0440\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u044F \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0430\xBB \u043D\u0430 \u0432\u043A\u043B\u0430\u0434\u043A\u0435 \u0418\u043D\u0444\u043E."),t()()())}function Pe(n,o){n&1&&(i(0,"span",6),a(1,"progress_activity"),t())}function Ue(n,o){n&1&&(i(0,"span",7),a(1,"add_card"),t())}function Ie(n,o){n&1&&(i(0,"span",28)(1,"span",7),a(2,"check_circle"),t(),a(3," \u0411\u0430\u043B\u0430\u043D\u0441 \u043F\u043E\u043F\u043E\u043B\u043D\u0435\u043D "),t())}function Oe(n,o){if(n&1&&(i(0,"span",29),a(1),t()),n&2){let e=u(5);l(),b(e.depositError)}}function Be(n,o){if(n&1){let e=h();i(0,"h2",36),a(1,"\u041F\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0431\u0430\u043B\u0430\u043D\u0441"),t(),i(2,"div",38)(3,"div",15)(4,"label",16),a(5,"\u0421\u0443\u043C\u043C\u0430 (\u20AC) *"),t(),i(6,"input",39),f("ngModelChange",function(r){_(e);let d=u(4);return x(d.depositAmount,r)||(d.depositAmount=r),p(r)}),t()(),i(7,"div",40)(8,"label",16),a(9,"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439"),t(),i(10,"input",41),f("ngModelChange",function(r){_(e);let d=u(4);return x(d.depositDescription,r)||(d.depositDescription=r),p(r)}),t()()(),i(11,"div",26)(12,"button",42),C("click",function(){_(e);let r=u(4);return p(r.deposit())}),c(13,Pe,2,0,"span",6)(14,Ue,2,0,"span",7),a(15," \u041F\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u044C "),t(),c(16,Ie,4,0,"span",28),c(17,Oe,2,1,"span",29),t()}if(n&2){let e=u(4);l(6),g("ngModel",e.depositAmount),l(4),g("ngModel",e.depositDescription),l(2),v("disabled",e.depositSaving||!e.depositAmount||e.depositAmount<=0),l(),m(e.depositSaving?13:14),l(3),m(e.depositSuccess?16:-1),l(),m(e.depositError?17:-1)}}function Fe(n,o){n&1&&(i(0,"div",4)(1,"span",6),a(2,"progress_activity"),t()())}function Ve(n,o){n&1&&(i(0,"div",37)(1,"span",7),a(2,"receipt_long"),t(),i(3,"p"),a(4,"\u0422\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0439 \u043D\u0435\u0442"),t()())}function Ae(n,o){if(n&1&&(i(0,"tr")(1,"td",46),a(2),y(3,"date"),t(),i(4,"td")(5,"span",47),a(6),t()(),i(7,"td",48),a(8),y(9,"number"),t(),i(10,"td",3),a(11),y(12,"number"),t(),i(13,"td",49),a(14),t()()),n&2){let e=o.$implicit,s=u(5);l(2),b(T(3,12,e.createdAt,"dd.MM.yy HH:mm")),l(3),P(e.amount>=0?"badge--green":"badge--red"),l(),E(" ",s.txTypeLabel(e.type)," "),l(),k("tx-amount--positive",e.amount>=0)("tx-amount--negative",e.amount<0),l(),W(" ",e.amount>=0?"+":"","\u20AC",T(9,15,e.amount,"1.2-2")," "),l(3),E("\u20AC",T(12,18,e.balanceAfter,"1.2-2")),l(3),b(e.description)}}function Le(n,o){if(n&1){let e=h();i(0,"div",45)(1,"button",50),C("click",function(){_(e);let r=u(5);return p(r.goToPage(r.txPage-1))}),i(2,"span",7),a(3,"chevron_left"),t()(),i(4,"span",51),a(5),t(),i(6,"button",50),C("click",function(){_(e);let r=u(5);return p(r.goToPage(r.txPage+1))}),i(7,"span",7),a(8,"chevron_right"),t()()()}if(n&2){let e=u(5);l(),v("disabled",e.txPage<=1),l(4),W("",e.txPage," / ",e.txPages()),l(),v("disabled",e.txPage>=e.txPages())}}function We(n,o){if(n&1&&(i(0,"div",43)(1,"table",44)(2,"thead")(3,"tr")(4,"th"),a(5,"\u0414\u0430\u0442\u0430"),t(),i(6,"th"),a(7,"\u0422\u0438\u043F"),t(),i(8,"th"),a(9,"\u0421\u0443\u043C\u043C\u0430"),t(),i(10,"th"),a(11,"\u0411\u0430\u043B\u0430\u043D\u0441 \u043F\u043E\u0441\u043B\u0435"),t(),i(12,"th"),a(13,"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435"),t()()(),i(14,"tbody"),w(15,Ae,15,21,"tr",null,xe),t()()(),c(17,Le,9,4,"div",45)),n&2){let e=u(4);l(15),D(e.transactions),l(2),m(e.txPages()>1?17:-1)}}function Ne(n,o){if(n&1){let e=h();i(0,"div",30)(1,"div",31),a(2,"\u0422\u0435\u043A\u0443\u0449\u0438\u0439 \u0431\u0430\u043B\u0430\u043D\u0441"),t(),i(3,"div",32),a(4),y(5,"number"),t(),i(6,"button",33),C("click",function(){_(e);let r=u(3);return p(r.loadBalance())}),i(7,"span",7),a(8,"refresh"),t(),a(9," \u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C "),t()(),i(10,"div",34),c(11,Me,8,0,"div",35)(12,Be,18,6),t(),i(13,"div",11)(14,"h2",36),a(15,"\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0439"),t(),c(16,Fe,3,0,"div",4),c(17,Ve,5,0,"div",37),c(18,We,18,1),t()}if(n&2){let e=u(3);l(4),E("\u20AC",T(5,5,e.balance??0,"1.2-2")),l(7),m(e.user.isVerified?12:11),l(5),m(e.txLoading?16:-1),l(),m(!e.txLoading&&e.transactions.length===0?17:-1),l(),m(!e.txLoading&&e.transactions.length>0?18:-1)}}function Re(n,o){if(n&1&&(c(0,ke,3,0,"div",4),c(1,Ne,19,8)),n&2){let e=u(2);m(e.balanceLoading?0:-1),l(),m(e.balanceLoading?-1:1)}}function je(n,o){n&1&&(i(0,"span",6),a(1,"progress_activity"),t())}function ze(n,o){n&1&&(i(0,"span",7),a(1,"send"),t())}function Ge(n,o){n&1&&(i(0,"span",28)(1,"span",7),a(2,"check_circle"),t(),a(3," \u041F\u0438\u0441\u044C\u043C\u043E \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u043E "),t())}function He(n,o){if(n&1&&(i(0,"span",29),a(1),t()),n&2){let e=u(3);l(),b(e.emailError)}}function Xe(n,o){if(n&1){let e=h();i(0,"div",11)(1,"h2",36),a(2,"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u043F\u0438\u0441\u044C\u043C\u043E"),t(),i(3,"div",15)(4,"label",16),a(5,"\u0422\u0435\u043C\u0430"),t(),i(6,"input",52),f("ngModelChange",function(r){_(e);let d=u(2);return x(d.emailSubject,r)||(d.emailSubject=r),p(r)}),t()(),i(7,"div",15)(8,"label",16),a(9,"\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435"),t(),i(10,"textarea",53),f("ngModelChange",function(r){_(e);let d=u(2);return x(d.emailMessage,r)||(d.emailMessage=r),p(r)}),t()(),i(11,"div",26)(12,"button",27),C("click",function(){_(e);let r=u(2);return p(r.sendEmail())}),c(13,je,2,0,"span",6)(14,ze,2,0,"span",7),a(15," \u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C "),t(),c(16,Ge,4,0,"span",28),c(17,He,2,1,"span",29),t()()}if(n&2){let e=u(2);l(6),g("ngModel",e.emailSubject),l(4),g("ngModel",e.emailMessage),l(2),v("disabled",e.emailSending||!e.emailSubject||!e.emailMessage),l(),m(e.emailSending?13:14),l(3),m(e.emailSent?16:-1),l(),m(e.emailError?17:-1)}}function Ye(n,o){if(n&1&&j(0,"app-user-tasks",12),n&2){let e=u(2);v("userId",e.userId)}}function qe(n,o){if(n&1){let e=h();c(0,he,10,0,"div",8),i(1,"div",9)(2,"button",10),C("click",function(){_(e);let r=u();return p(r.activeTab="info")}),i(3,"span",7),a(4,"person"),t(),a(5," \u0418\u043D\u0444\u043E "),t(),i(6,"button",10),C("click",function(){_(e);let r=u();return p(r.openBalanceTab())}),i(7,"span",7),a(8,"account_balance_wallet"),t(),a(9," \u0411\u0430\u043B\u0430\u043D\u0441 "),t(),i(10,"button",10),C("click",function(){_(e);let r=u();return p(r.activeTab="actions")}),i(11,"span",7),a(12,"mail"),t(),a(13," \u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F "),t(),i(14,"button",10),C("click",function(){_(e);let r=u();return p(r.activeTab="tasks")}),i(15,"span",7),a(16,"checklist"),t(),a(17," \u0417\u0430\u0434\u0430\u0447\u0438 "),t()(),c(18,De,40,11,"div",11),c(19,Re,2,2),c(20,Xe,18,6,"div",11),c(21,Ye,1,1,"app-user-tasks",12)}if(n&2){let e=u();m(e.isRestrictedCountry?0:-1),l(2),k("tab-btn--active",e.activeTab==="info"),l(4),k("tab-btn--active",e.activeTab==="balance"),l(4),k("tab-btn--active",e.activeTab==="actions"),l(4),k("tab-btn--active",e.activeTab==="tasks"),l(4),m(e.activeTab==="info"?18:-1),l(),m(e.activeTab==="balance"?19:-1),l(),m(e.activeTab==="actions"?20:-1),l(),m(e.activeTab==="tasks"?21:-1)}}var Je=["\u{1F1F7}\u{1F1FA}","\u{1F1E7}\u{1F1FE}"],ie=class n{route=S(G);userService=S(ee);balanceService=S(V);userId="";user=null;loading=!0;saving=!1;error="";saveSuccess=!1;activeTab="info";formFirstName="";formLastName="";formPhone="";formCountryFlag="";formStatus="";formRole="";formIsVerified=!1;emailSubject="";emailMessage="";emailSending=!1;emailSent=!1;emailError="";balance=null;balanceLoading=!1;transactions=[];txTotal=0;txPage=1;txLimit=20;txLoading=!1;depositAmount=null;depositDescription="";depositSaving=!1;depositSuccess=!1;depositError="";statuses=["active","blocked","pending"];roles=["client","manager","admin","bot"];get isRestrictedCountry(){return this.user?.countryFlag?Je.some(o=>this.user.countryFlag.includes(o)):!1}ngOnInit(){this.userId=this.route.snapshot.paramMap.get("id")??"",this.loadUser()}loadUser(){this.loading=!0,this.error="",this.userService.getUser(this.userId).subscribe({next:o=>{this.user=o,this.fillForm(o),this.loading=!1},error:()=>{this.error="\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u043F\u0440\u043E\u0444\u0438\u043B\u044C",this.loading=!1}})}fillForm(o){this.formFirstName=o.firstName,this.formLastName=o.lastName,this.formPhone=o.phone??"",this.formCountryFlag=o.countryFlag??"",this.formStatus=o.status,this.formRole=o.role,this.formIsVerified=o.isVerified}saveInfo(){this.saving=!0,this.saveSuccess=!1,this.error="",this.userService.managerUpdateUser(this.userId,{firstName:this.formFirstName,lastName:this.formLastName,phone:this.formPhone||void 0,countryFlag:this.formCountryFlag||void 0,status:this.formStatus,role:this.formRole,isVerified:this.formIsVerified}).subscribe({next:o=>{this.user=o,this.saving=!1,this.saveSuccess=!0,setTimeout(()=>this.saveSuccess=!1,3e3)},error:o=>{this.error=o?.error?.message??"\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F",this.saving=!1}})}sendEmail(){!this.emailSubject||!this.emailMessage||(this.emailSending=!0,this.emailSent=!1,this.emailError="",this.userService.sendCustomEmail(this.userId,this.emailSubject,this.emailMessage).subscribe({next:()=>{this.emailSending=!1,this.emailSent=!0,this.emailSubject="",this.emailMessage="",setTimeout(()=>this.emailSent=!1,4e3)},error:()=>{this.emailSending=!1,this.emailError="\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0438"}}))}openBalanceTab(){this.activeTab="balance",this.balance===null&&this.loadBalance()}loadBalance(){this.balanceLoading=!0,this.balanceService.getUserBalance(this.userId).subscribe({next:o=>{this.balance=o.balance,this.balanceLoading=!1,this.loadTransactions()},error:()=>this.balanceLoading=!1})}loadTransactions(){this.txLoading=!0,this.balanceService.getUserTransactions(this.userId,this.txPage,this.txLimit).subscribe({next:o=>{this.transactions=o.data,this.txTotal=o.total,this.txLoading=!1},error:()=>this.txLoading=!1})}txPages(){return Math.ceil(this.txTotal/this.txLimit)}goToPage(o){o<1||o>this.txPages()||(this.txPage=o,this.loadTransactions())}deposit(){!this.depositAmount||this.depositAmount<=0||(this.depositSaving=!0,this.depositSuccess=!1,this.depositError="",this.balanceService.adjustBalance(this.userId,{amount:this.depositAmount,type:"deposit",description:this.depositDescription||"\u041F\u043E\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u0435 \u0431\u0430\u043B\u0430\u043D\u0441\u0430"}).subscribe({next:()=>{this.depositSaving=!1,this.depositSuccess=!0,this.depositAmount=null,this.depositDescription="",this.loadBalance(),setTimeout(()=>this.depositSuccess=!1,4e3)},error:o=>{this.depositSaving=!1,this.depositError=o?.error?.message??"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F"}}))}txTypeLabel(o){return{deposit:"\u0414\u0435\u043F\u043E\u0437\u0438\u0442",refund:"\u0412\u043E\u0437\u0432\u0440\u0430\u0442",car_payment:"\u041E\u043F\u043B\u0430\u0442\u0430 \u0430\u0432\u0442\u043E",commission:"\u041A\u043E\u043C\u0438\u0441\u0441\u0438\u044F",delivery:"\u0414\u043E\u0441\u0442\u0430\u0432\u043A\u0430",customs:"\u0422\u0430\u043C\u043E\u0436\u043D\u044F",bid_lock:"\u0411\u043B\u043E\u043A. \u0441\u0442\u0430\u0432\u043A\u0438",bid_unlock:"\u0420\u0430\u0437\u0431\u043B. \u0441\u0442\u0430\u0432\u043A\u0438"}[o]??o}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=M({type:n,selectors:[["app-user-detail"]],decls:8,vars:4,consts:[[1,"page"],[1,"page-header"],[1,"page-title"],[1,"text-muted"],[1,"state-loading"],[1,"state-error"],[1,"material-symbols-rounded","spin"],[1,"material-symbols-rounded"],[1,"restriction-banner"],[1,"tabs"],[1,"tab-btn",3,"click"],[1,"card"],[3,"userId"],[1,"restriction-banner__text"],[1,"form-grid"],[1,"form-group"],[1,"form-label"],["placeholder","\u0418\u043C\u044F",1,"form-control",3,"ngModelChange","ngModel"],["placeholder","\u0424\u0430\u043C\u0438\u043B\u0438\u044F",1,"form-control",3,"ngModelChange","ngModel"],["placeholder","+7 999 000 00 00",1,"form-control",3,"ngModelChange","ngModel"],["placeholder","\u{1F1E9}\u{1F1EA}","maxlength","10",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-control",3,"ngModelChange","ngModel"],[3,"value"],[1,"form-group","form-group--checkbox"],[1,"checkbox-label"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"form-actions"],[1,"btn","btn--primary",3,"click","disabled"],[1,"save-success"],[1,"save-error"],[1,"balance-summary","card"],[1,"balance-summary__label"],[1,"balance-summary__amount"],[1,"btn","btn--secondary","btn--sm",3,"click"],[1,"card","deposit-card"],[1,"verify-gate"],[1,"card-title"],[1,"empty-state"],[1,"form-row"],["type","number","min","1","placeholder","500",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-group","form-group--wide"],["placeholder","\u041F\u043E\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u0435 \u0441\u0447\u0451\u0442\u0430",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn--primary","btn--sm",3,"click","disabled"],[1,"table-wrap"],[1,"data-table"],[1,"pagination"],[1,"text-muted","tx-date"],[1,"badge"],[1,"tx-amount"],[1,"text-muted","tx-desc"],[1,"btn","btn--secondary","btn--sm",3,"click","disabled"],[1,"pagination__info"],["placeholder","\u0422\u0435\u043C\u0430 \u043F\u0438\u0441\u044C\u043C\u0430",1,"form-control",3,"ngModelChange","ngModel"],["rows","6","placeholder","\u0422\u0435\u043A\u0441\u0442 \u043F\u0438\u0441\u044C\u043C\u0430...",1,"form-control",3,"ngModelChange","ngModel"]],template:function(e,s){e&1&&(i(0,"div",0)(1,"div",1)(2,"h1",2),a(3,"\u041F\u0440\u043E\u0444\u0438\u043B\u044C \u043A\u043B\u0438\u0435\u043D\u0442\u0430"),t(),c(4,fe,2,1,"span",3),t(),c(5,be,3,0,"div",4),c(6,ve,4,1,"div",5),c(7,qe,22,13),t()),e&2&&(l(4),m(s.user?4:-1),l(),m(s.loading?5:-1),l(),m(s.error&&!s.loading?6:-1),l(),m(!s.loading&&s.user?7:-1))},dependencies:[F,K,Q,I,q,Y,J,O,$,Z,B,A,U,z],styles:[".tabs[_ngcontent-%COMP%]{display:flex;gap:4px;margin-bottom:20px;border-bottom:1px solid var(--border);padding-bottom:0}.tab-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:10px 18px;border:none;background:none;color:var(--text-secondary);cursor:pointer;font-size:var(--fs-sm);font-weight:500;border-bottom:2px solid transparent;margin-bottom:-1px;transition:color .15s,border-color .15s}.tab-btn[_ngcontent-%COMP%]:hover{color:var(--text-primary)}.tab-btn--active[_ngcontent-%COMP%]{color:var(--accent);border-bottom-color:var(--accent)}.restriction-banner[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px;background:#f59e0b1a;border:1px solid rgba(245,158,11,.35);border-radius:var(--radius-lg);padding:14px 18px;margin-bottom:20px;color:#92400e}.restriction-banner[_ngcontent-%COMP%]   .material-symbols-rounded[_ngcontent-%COMP%]{font-size:22px;color:#d97706;flex-shrink:0;margin-top:1px}.restriction-banner__text[_ngcontent-%COMP%]{font-size:var(--fs-sm);line-height:1.5}.restriction-banner__text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;margin-bottom:2px}.card[_ngcontent-%COMP%]{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;margin-bottom:16px}.card-title[_ngcontent-%COMP%]{font-size:var(--fs-base);font-weight:600;margin:0 0 20px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}.form-row[_ngcontent-%COMP%]{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:4px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;flex:1;min-width:160px}.form-group--wide[_ngcontent-%COMP%]{flex:2}.form-group--checkbox[_ngcontent-%COMP%]{justify-content:flex-end;padding-bottom:4px;flex:none;min-width:auto}.form-label[_ngcontent-%COMP%]{font-size:var(--fs-sm);color:var(--text-secondary);font-weight:500}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:var(--fs-sm);cursor:pointer}.form-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-top:24px}.save-success[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:var(--green);font-size:var(--fs-sm)}.save-error[_ngcontent-%COMP%]{color:var(--red);font-size:var(--fs-sm)}.balance-summary[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px;padding:20px 24px}.balance-summary__label[_ngcontent-%COMP%]{font-size:var(--fs-sm);color:var(--text-secondary);font-weight:500}.balance-summary__amount[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:var(--text-primary);flex:1}.deposit-card[_ngcontent-%COMP%]{padding:20px 24px}.verify-gate[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:14px;color:var(--text-secondary)}.verify-gate[_ngcontent-%COMP%]   .material-symbols-rounded[_ngcontent-%COMP%]{font-size:28px;color:var(--text-secondary);opacity:.5;flex-shrink:0}.verify-gate[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:var(--text-primary);margin-bottom:4px;font-size:var(--fs-sm)}.verify-gate[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:var(--fs-sm);margin:0;line-height:1.5}.tx-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:var(--fs-xs)}.tx-desc[_ngcontent-%COMP%]{max-width:220px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:var(--fs-xs)}.tx-amount[_ngcontent-%COMP%]{font-weight:600;font-size:var(--fs-sm)}.tx-amount--positive[_ngcontent-%COMP%]{color:var(--green)}.tx-amount--negative[_ngcontent-%COMP%]{color:var(--red)}.pagination[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:16px}.pagination__info[_ngcontent-%COMP%]{font-size:var(--fs-sm);color:var(--text-secondary);min-width:60px;text-align:center}"]})};export{ie as UserDetailComponent};
