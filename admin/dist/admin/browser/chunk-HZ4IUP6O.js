import{a as q}from"./chunk-ZLGP2HS2.js";import{c as U,f as $,i as H,j as Q,k as W,p as j}from"./chunk-NMP7FLI7.js";import{f as R,g as T,h as A,i as N,l as z,r as L,w as m}from"./chunk-Q2EY3VGC.js";import{$ as d,Ab as V,Cb as B,Eb as F,Ma as v,Nb as I,Ra as h,V as _,_ as c,bb as u,cb as e,db as t,eb as x,fb as C,ib as p,jb as S,lb as y,mb as P,nb as O,ob as M,qb as i,rb as w,sb as g,wa as s,wb as k,xb as E,yb as D}from"./chunk-PMJPP6QG.js";var J=["terminalBody"],K=a=>({"terminal-text--error":a});function X(a,r){if(a&1){let n=C();e(0,"button",35),p("click",function(){c(n);let l=S();return d(l.stopScraper())}),e(1,"span",7),i(2,"stop"),t(),i(3),t()}if(a&2){let n=S();u("disabled",n.isStopping),s(3),g(" ",n.isStopping?"\u041E\u0441\u0442\u0430\u043D\u0430\u0432\u043B\u0438\u0432\u0430\u0435\u0442\u0441\u044F...":"\u041E\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u0442\u044C"," ")}}function Y(a,r){a&1&&(e(0,"div",36),i(1," \u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0445 \u043B\u043E\u0433\u043E\u0432. \u041F\u0430\u0440\u0441\u0435\u0440 \u0435\u0449\u0435 \u043D\u0435 \u0431\u044B\u043B \u0437\u0430\u043F\u0443\u0449\u0435\u043D. "),t())}function Z(a,r){if(a&1&&(e(0,"div",37)(1,"span",38),i(2),B(3,"date"),t(),e(4,"span",39),i(5),t()()),a&2){let n=r.$implicit;s(2),g("[",F(3,3,n.timestamp,"HH:mm:ss"),"]"),s(2),u("ngClass",V(6,K,n.message.includes("Error")||n.message.includes("Fail"))),s(),w(n.message)}}var G=class a{http=_(L);cdr=_(I);socket;terminalBody;isRunning=!1;isStopping=!1;logs=[];selectedVendor="ecarstrade";shouldScroll=!1;ngOnInit(){this.checkStatus();let r=m.apiUrl.replace("/api","")+"/scraper";this.socket=q(r,{transports:["websocket"]}),this.socket.on("scraper-log",n=>{this.logs.push(n),this.shouldScroll=!0,this.cdr.detectChanges()})}ngAfterViewChecked(){this.shouldScroll&&(this.scrollToBottom(),this.shouldScroll=!1)}ngOnDestroy(){this.socket&&this.socket.disconnect()}checkStatus(){this.http.get(`${m.apiUrl}/scraper/status`).subscribe(r=>{this.isRunning=r.isRunning,this.isStopping=!!r.isStopping,this.cdr.detectChanges()})}startScraper(){this.isRunning||(this.isRunning=!0,this.logs=[{timestamp:new Date().toISOString(),message:`Starting ${this.selectedVendor} scraper task...`}],this.http.post(`${m.apiUrl}/scraper/run`,{vendor:this.selectedVendor,maxPages:1}).subscribe({next:r=>{this.logs.push({timestamp:new Date().toISOString(),message:"Scraper process initialized successfully."}),this.checkStatus()},error:r=>{this.isRunning=!1,this.logs.push({timestamp:new Date().toISOString(),message:`Error starting scraper: ${r.message}`}),this.cdr.detectChanges()}}))}stopScraper(){!this.isRunning||this.isStopping||(this.isStopping=!0,this.http.post(`${m.apiUrl}/scraper/stop`,{}).subscribe({next:r=>{this.logs.push({timestamp:new Date().toISOString(),message:r.message||"\u041E\u0441\u0442\u0430\u043D\u043E\u0432\u043A\u0430 \u043F\u0430\u0440\u0441\u0435\u0440\u0430..."}),this.checkStatus()},error:r=>{this.isStopping=!1,this.logs.push({timestamp:new Date().toISOString(),message:`\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0441\u0442\u0430\u043D\u043E\u0432\u043A\u0435 \u043F\u0430\u0440\u0441\u0435\u0440\u0430: ${r.message}`}),this.cdr.detectChanges()}}))}clearLogs(){this.logs=[]}scrollToBottom(){this.terminalBody&&(this.terminalBody.nativeElement.scrollTop=this.terminalBody.nativeElement.scrollHeight)}static \u0275fac=function(n){return new(n||a)};static \u0275cmp=v({type:a,selectors:[["app-scraper-page"]],viewQuery:function(n,o){if(n&1&&y(J,5),n&2){let l;P(l=O())&&(o.terminalBody=l.first)}},decls:50,vars:9,consts:[["terminalBody",""],[1,"page-header"],[1,"page-header__title-area"],[1,"page-header__title"],[1,"page-header__subtitle"],[1,"page-header__actions"],[1,"btn","btn--outline",3,"click"],[1,"material-symbols-rounded"],[1,"scraper-content"],[1,"card","scraper-control-card"],[1,"card-body"],[1,"card-title"],[1,"control-form"],[1,"form-group"],[1,"form-label"],[1,"form-select",3,"ngModelChange","ngModel","disabled"],["value","ecarstrade"],["value","autobid"],[1,"form-actions"],[1,"btn","btn--primary",3,"click","disabled"],["class","btn btn--danger","style","margin-left: 10px;",3,"disabled","click",4,"ngIf"],[1,"status-indicator"],[1,"status-indicator__dot"],[1,"status-indicator__text"],[1,"card","terminal-card"],[1,"terminal-header"],[1,"terminal-header__actions"],[1,"terminal-btn","terminal-btn--red"],[1,"terminal-btn","terminal-btn--yellow"],[1,"terminal-btn","terminal-btn--green"],[1,"terminal-title"],["title","\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u043B\u043E\u0433\u0438",1,"btn","btn--icon","terminal-clear",3,"click"],[1,"terminal-body"],["class","terminal-empty",4,"ngIf"],["class","terminal-line",4,"ngFor","ngForOf"],[1,"btn","btn--danger",2,"margin-left","10px",3,"click","disabled"],[1,"terminal-empty"],[1,"terminal-line"],[1,"terminal-time"],[1,"terminal-text",3,"ngClass"]],template:function(n,o){if(n&1){let l=C();e(0,"div",1)(1,"div",2)(2,"h1",3),i(3,"\u041F\u0430\u0440\u0441\u0435\u0440"),t(),e(4,"p",4),i(5,"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0441\u0431\u043E\u0440\u043E\u043C \u0434\u0430\u043D\u043D\u044B\u0445 \u0441 \u0430\u0443\u043A\u0446\u0438\u043E\u043D\u043E\u0432"),t()(),e(6,"div",5)(7,"button",6),p("click",function(){return c(l),d(o.checkStatus())}),e(8,"span",7),i(9,"refresh"),t(),i(10," \u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441 "),t()()(),e(11,"div",8)(12,"div",9)(13,"div",10)(14,"h2",11),i(15,"\u0417\u0430\u043F\u0443\u0441\u043A \u043F\u0430\u0440\u0441\u0435\u0440\u0430"),t(),e(16,"div",12)(17,"div",13)(18,"label",14),i(19,"\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A \u0434\u0430\u043D\u043D\u044B\u0445"),t(),e(20,"select",15),D("ngModelChange",function(b){return c(l),E(o.selectedVendor,b)||(o.selectedVendor=b),d(b)}),e(21,"option",16),i(22,"eCarsTrade"),t(),e(23,"option",17),i(24,"Autobid.de"),t()()(),e(25,"div",18)(26,"button",19),p("click",function(){return c(l),d(o.startScraper())}),e(27,"span",7),i(28,"play_arrow"),t(),i(29," \u0417\u0430\u043F\u0443\u0441\u0442\u0438\u0442\u044C \u043F\u0430\u0440\u0441\u0435\u0440 "),t(),h(30,X,4,2,"button",20),t()(),e(31,"div",21),x(32,"span",22),e(33,"span",23),i(34),t()()()(),e(35,"div",24)(36,"div",25)(37,"div",26),x(38,"div",27)(39,"div",28)(40,"div",29),t(),e(41,"div",30),i(42,"Live Logs"),t(),e(43,"button",31),p("click",function(){return c(l),d(o.clearLogs())}),e(44,"span",7),i(45,"clear_all"),t()()(),e(46,"div",32,0),h(48,Y,2,0,"div",33)(49,Z,6,8,"div",34),t()()()}n&2&&(s(20),k("ngModel",o.selectedVendor),u("disabled",o.isRunning),s(6),u("disabled",o.isRunning),s(4),u("ngIf",o.isRunning),s(),M("status-indicator--running",o.isRunning),s(3),g(" ",o.isRunning?"\u0410\u043A\u0442\u0438\u0432\u043D\u044B\u0439 \u043F\u0440\u043E\u0446\u0435\u0441\u0441 \u0441\u0431\u043E\u0440\u0430 \u0434\u0430\u043D\u043D\u044B\u0445":"\u041E\u0436\u0438\u0434\u0430\u0435\u0442 \u0437\u0430\u043F\u0443\u0441\u043A\u0430"," "),s(14),u("ngIf",o.logs.length===0),s(),u("ngForOf",o.logs))},dependencies:[z,R,T,A,j,Q,W,H,U,$,N],styles:[".scraper-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px;max-width:1000px}.scraper-control-card[_ngcontent-%COMP%]{padding:24px;background-color:var(--surface);border-radius:12px;border:1px solid var(--border)}.scraper-control-card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{margin-top:0;margin-bottom:20px;font-size:1.25rem;font-weight:600}.control-form[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:16px;margin-bottom:24px}.control-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1;max-width:300px}.control-form[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-size:.875rem;font-weight:500;color:var(--text-secondary)}.control-form[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]{width:100%;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background-color:var(--surface);color:var(--text);font-size:.95rem;outline:none;transition:all .2s ease}.control-form[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]:focus{border-color:var(--primary)}.status-indicator[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;padding:8px 16px;border-radius:20px;background-color:var(--surface-hover);border:1px solid var(--border)}.status-indicator__dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;background-color:var(--text-secondary);transition:background-color .3s ease}.status-indicator__text[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--text-secondary)}.status-indicator--running[_ngcontent-%COMP%]{background-color:#22c55e1a;border-color:#22c55e33}.status-indicator--running[_ngcontent-%COMP%]   .status-indicator__dot[_ngcontent-%COMP%]{background-color:#22c55e;box-shadow:0 0 8px #22c55e99;animation:_ngcontent-%COMP%_pulse 1.5s infinite}.status-indicator--running[_ngcontent-%COMP%]   .status-indicator__text[_ngcontent-%COMP%]{color:#16a34a}@keyframes _ngcontent-%COMP%_pulse{0%{box-shadow:0 0 #22c55eb3}70%{box-shadow:0 0 0 10px #22c55e00}to{box-shadow:0 0 #22c55e00}}.terminal-card[_ngcontent-%COMP%]{border-radius:12px;overflow:hidden;background-color:#1a1a1a;border:1px solid #333;box-shadow:0 4px 20px #00000026}.terminal-header[_ngcontent-%COMP%]{display:flex;align-items:center;background-color:#2a2a2a;padding:12px 16px;border-bottom:1px solid #111}.terminal-header__actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-right:16px}.terminal-btn[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%}.terminal-btn--red[_ngcontent-%COMP%]{background-color:#ff5f56}.terminal-btn--yellow[_ngcontent-%COMP%]{background-color:#ffbd2e}.terminal-btn--green[_ngcontent-%COMP%]{background-color:#27c93f}.terminal-title[_ngcontent-%COMP%]{color:#888;font-family:monospace;font-size:.875rem;flex:1;text-align:center}.terminal-clear[_ngcontent-%COMP%]{color:#888;padding:4px;background:none;border:none;border-radius:4px;cursor:pointer}.terminal-clear[_ngcontent-%COMP%]:hover{color:#fff;background-color:#ffffff1a}.terminal-clear[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px}.terminal-body[_ngcontent-%COMP%]{height:400px;overflow-y:auto;padding:16px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:.85rem;line-height:1.5;color:#e2e8f0}.terminal-body[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.terminal-body[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1a1a1a}.terminal-body[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#444;border-radius:4px}.terminal-empty[_ngcontent-%COMP%]{color:#666;font-style:italic;text-align:center;margin-top:40px}.terminal-line[_ngcontent-%COMP%]{margin-bottom:4px;word-wrap:break-word}.terminal-time[_ngcontent-%COMP%]{color:#8b949e;margin-right:12px;-webkit-user-select:none;user-select:none}.terminal-text[_ngcontent-%COMP%]{color:#a3be8c}.terminal-text--error[_ngcontent-%COMP%]{color:#bf616a}"]})};export{G as ScraperPageComponent};
