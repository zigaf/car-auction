<div class="page">
  <div class="page-header">
    <h1 class="page-title">–¢–æ—Ä–≥–æ–≤—ã–µ –±–æ—Ç—ã</h1>
    <button class="btn btn--primary btn--sm" (click)="showCreateForm = !showCreateForm">
      <span class="material-symbols-rounded">{{ showCreateForm ? 'close' : 'add' }}</span>
      {{ showCreateForm ? '–û—Ç–º–µ–Ω–∞' : '–°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞' }}
    </button>
  </div>

  @if (showCreateForm) {
    <div class="card create-form">
      <h2 class="card-title">–ù–æ–≤—ã–π –±–æ—Ç-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h2>
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">Email *</label>
          <input class="form-control" [(ngModel)]="newEmail" placeholder="bot&#64;example.com" type="email" />
        </div>
        <div class="form-group">
          <label class="form-label">–ò–º—è *</label>
          <input class="form-control" [(ngModel)]="newFirstName" placeholder="–ò–≤–∞–Ω" />
        </div>
        <div class="form-group">
          <label class="form-label">–§–∞–º–∏–ª–∏—è *</label>
          <input class="form-control" [(ngModel)]="newLastName" placeholder="–ü–µ—Ç—Ä–æ–≤" />
        </div>
        <div class="form-group">
          <label class="form-label">–§–ª–∞–≥ —Å—Ç—Ä–∞–Ω—ã (emoji)</label>
          <input class="form-control" [(ngModel)]="newCountryFlag" placeholder="üá©üá™" maxlength="8" />
        </div>
      </div>
      <div class="form-actions">
        <button
          class="btn btn--primary btn--sm"
          [disabled]="creating || !newEmail || !newFirstName || !newLastName"
          (click)="createBot()"
        >
          @if (creating) { <span class="material-symbols-rounded spin">progress_activity</span> }
          –°–æ–∑–¥–∞—Ç—å
        </button>
        @if (createError) { <span class="save-error">{{ createError }}</span> }
      </div>
    </div>
  }

  @if (loading) {
    <div class="state-loading">
      <span class="material-symbols-rounded spin">progress_activity</span>
    </div>
  }

  @if (!loading) {
    <section class="section">
      <h2 class="section-title">–ü—Ä–æ—Ñ–∏–ª–∏ –±–æ—Ç–æ–≤ ({{ botUsers.length }})</h2>

      @if (botUsers.length === 0) {
        <div class="empty-state">
          <span class="material-symbols-rounded">smart_toy</span>
          <p>–ë–æ—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
        </div>
      }

      <div class="bot-grid">
        @for (bot of botUsers; track bot.id) {
          <div class="bot-card card">
            <div class="bot-card__avatar">{{ bot.countryFlag || 'ü§ñ' }}</div>
            <div class="bot-card__info">
              <div class="bot-card__name">{{ bot.firstName }} {{ bot.lastName }}</div>
              <div class="bot-card__email text-muted">{{ bot.email }}</div>
            </div>
            <button class="icon-btn icon-btn--danger" (click)="deleteBot(bot.id)" title="–£–¥–∞–ª–∏—Ç—å –±–æ—Ç–∞">
              <span class="material-symbols-rounded">delete</span>
            </button>
          </div>
        }
      </div>
    </section>

    <section class="section">
      <h2 class="section-title">–ê–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ ({{ configs.length }})</h2>

      @if (configs.length === 0) {
        <p class="text-muted">
          –ö–æ–Ω—Ñ–∏–≥–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
          <a href="/auctions/schedule" class="link">–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–æ–≤</a>.
        </p>
      }

      <div class="table-wrap">
        @if (configs.length > 0) {
          <table class="data-table">
            <thead>
              <tr>
                <th>–õ–æ—Ç</th>
                <th>–ë–æ—Ç</th>
                <th>–ú–∞–∫—Å. —Ü–µ–Ω–∞</th>
                <th>–ü–∞—Ç—Ç–µ—Ä–Ω</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody>
              @for (cfg of configs; track cfg.id) {
                <tr>
                  <td class="text-muted">
                    {{ cfg.lot?.title ?? cfg.lotId.slice(0, 8) + '‚Ä¶' }}
                  </td>
                  <td>
                    {{ cfg.botUser?.firstName ?? '‚Äî' }} {{ cfg.botUser?.lastName ?? '' }}
                    {{ cfg.botUser?.countryFlag ?? '' }}
                  </td>
                  <td>‚Ç¨{{ cfg.maxPrice | number }}</td>
                  <td>
                    <span class="badge badge--gray">{{ cfg.pattern }}</span>
                  </td>
                  <td>
                    <span class="badge" [class]="cfg.isActive ? 'badge--green' : 'badge--gray'">
                      {{ cfg.isActive ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–û—Ç–∫–ª—é—á—ë–Ω' }}
                    </span>
                  </td>
                  <td class="actions-cell">
                    <button
                      class="btn btn--sm"
                      [class]="cfg.isActive ? 'btn--secondary' : 'btn--primary'"
                      (click)="toggleConfig(cfg)"
                    >
                      {{ cfg.isActive ? '–í—ã–∫–ª—é—á–∏—Ç—å' : '–í–∫–ª—é—á–∏—Ç—å' }}
                    </button>
                    <button class="icon-btn icon-btn--danger" (click)="deleteConfig(cfg.id)" title="–£–¥–∞–ª–∏—Ç—å">
                      <span class="material-symbols-rounded">delete</span>
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        }
      </div>
    </section>
  }
</div>
